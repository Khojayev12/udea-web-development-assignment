{% extends 'layout.html' %}

{% block body %}
{% set card_image = url_for('static', filename='media/registration.png') %}
<div class="search-hero">
    <div class="search-hero__content">
        <div class="search-bar-wrapper">
            <form class="hero-search-form" action="{{ url_for('search') }}" method="get" data-search-form>
                <label class="sr-only" for="search-page-input">Search for recipes</label>
                <input
                    id="search-page-input"
                    type="search"
                    name="q"
                    value="{{ query }}"
                    class="main-hero-search search-solid"
                    placeholder="search for recipies..."
                    autocomplete="off"
                    data-search-input
                />
                <button class="main-hero-search-btn" type="submit" aria-label="Search">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </button>
            </form>
            <div class="search-suggestions" data-search-suggestions></div>
        </div>
        <p class="search-hero__subtitle">
            {% if query %}
                Showing results for "{{ query }}" ({{ total_count }} found)
            {% else %}
                Start typing to find recipes by title, ingredient, or category.
            {% endif %}
        </p>
    </div>
</div>

<div class="feed-page search-feed-page">
    <div class="feed-filters-pane filters-close search-filters-hidden" aria-hidden="true"></div>
    <div class="feed-list-page">
        <div class="feed-pagination feed-pagination-top">
            {% if prev_page %}
                <a class="feed-page-btn" href="{{ url_for('search', page=prev_page, q=query) }}">&larr; Prev</a>
            {% else %}
                <span class="feed-page-btn disabled">&larr; Prev</span>
            {% endif %}
            <span class="feed-page-status">Page {{ page }} of {{ total_pages }}</span>
            {% if next_page %}
                <a class="feed-page-btn" href="{{ url_for('search', page=next_page, q=query) }}">Next &rarr;</a>
            {% else %}
                <span class="feed-page-btn disabled">Next &rarr;</span>
            {% endif %}
        </div>

        {% if recipes and recipes|length > 0 %}
            {% for recipe in recipes %}
                <a class="recipe-card" href="{{ url_for('recipe', recipe_id=recipe.id) }}">
                    <div class="recipe-card__image-wrapper">
                        <img
                            class="recipe-card__image"
                            src="{{ recipe.image or card_image }}"
                            alt="{{ recipe.title }}"
                            onerror="this.onerror=null;this.src='{{ card_image }}';"
                        >
                        <button
                            class="recipe-card__favorite {% if recipe.is_favorited %}is-liked{% endif %}"
                            type="button"
                            aria-label="Save {{ recipe.title }}"
                            aria-pressed="{{ 'true' if recipe.is_favorited else 'false' }}"
                            data-recipe-id="{{ recipe.id }}"
                            data-liked="{{ 'true' if recipe.is_favorited else 'false' }}"
                        >
                            <svg class="recipe-card__favorite-icon" viewBox="0 0 24 24" aria-hidden="true">
                                <path
                                    d="M12.1 20.3a1 1 0 0 1-1.2 0C6.1 16.9 3 13.9 3 10.2 3 7.5 5.2 5 8.3 5c1.5 0 2.9.7 3.7 1.9C12.9 5.7 14.3 5 15.8 5 19 5 21 7.5 21 10.2c0 3.7-3.1 6.7-7.9 10.1z"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="1.7"
                                />
                            </svg>
                        </button>
                    </div>
                    <div class="recipe-card__body">
                        <h3 class="recipe-card__title">{{ recipe.title }}</h3>
                        <p class="recipe-card__author">{{ recipe.prepare_time or 0 }} min</p>
                        <div class="recipe-card__rating" aria-label="Rated {{ recipe.rating or 0 }} out of five stars">
                            {% set rating_int = (recipe.rating or 0)|int %}
                            {% for _ in range(0, 5) %}
                                <span class="rating-star {% if loop.index <= rating_int %}is-filled{% endif %}"></span>
                            {% endfor %}
                        </div>
                    </div>
                </a>
            {% endfor %}
        {% else %}
            <p class="search-empty">No recipes found. Try a different keyword.</p>
        {% endif %}

        <div class="feed-pagination feed-pagination-bottom">
            {% if prev_page %}
                <a class="feed-page-btn" href="{{ url_for('search', page=prev_page, q=query) }}">&larr; Prev</a>
            {% else %}
                <span class="feed-page-btn disabled">&larr; Prev</span>
            {% endif %}
            <span class="feed-page-status">Page {{ page }} of {{ total_pages }}</span>
            {% if next_page %}
                <a class="feed-page-btn" href="{{ url_for('search', page=next_page, q=query) }}">Next &rarr;</a>
            {% else %}
                <span class="feed-page-btn disabled">Next &rarr;</span>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
